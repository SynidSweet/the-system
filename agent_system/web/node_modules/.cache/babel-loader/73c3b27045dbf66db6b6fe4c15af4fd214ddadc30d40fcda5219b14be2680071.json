{"ast":null,"code":"import _objectWithoutProperties from\"/code/personal/the-system/agent_system/web/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";import _objectSpread from\"/code/personal/the-system/agent_system/web/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";const _excluded=[\"node\",\"inline\",\"className\",\"children\"],_excluded2=[\"node\"];import React,{useState,useEffect,useCallback}from'react';import ReactMarkdown from'react-markdown';import remarkGfm from'remark-gfm';import'./DocumentBrowser.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function DocumentBrowser(_ref){let{apiBaseUrl}=_ref;const[documents,setDocuments]=useState([]);const[selectedDoc,setSelectedDoc]=useState(null);const[editMode,setEditMode]=useState(false);const[editedContent,setEditedContent]=useState('');const[loading,setLoading]=useState(true);const[saving,setSaving]=useState(false);const[error,setError]=useState(null);const[filter,setFilter]=useState('');const[showMarkdownPreview,setShowMarkdownPreview]=useState(true);const fetchDocuments=useCallback(async()=>{try{const response=await fetch(\"\".concat(apiBaseUrl,\"/documents\"));const data=await response.json();setDocuments(data.documents);setLoading(false);}catch(err){setError('Failed to load documents');setLoading(false);}},[apiBaseUrl]);useEffect(()=>{fetchDocuments();},[fetchDocuments]);const selectDocument=useCallback(async doc=>{try{const response=await fetch(\"\".concat(apiBaseUrl,\"/documents/\").concat(doc.name));const data=await response.json();setSelectedDoc(data);setEditedContent(data.content);setEditMode(false);}catch(err){setError('Failed to load document details');}},[apiBaseUrl]);const handleEdit=useCallback(()=>{setEditMode(true);},[]);const handleCancel=useCallback(()=>{setEditMode(false);if(selectedDoc){setEditedContent(selectedDoc.content);}},[selectedDoc]);const handleSave=useCallback(async()=>{if(!selectedDoc)return;setSaving(true);try{const response=await fetch(\"\".concat(apiBaseUrl,\"/documents/\").concat(selectedDoc.name),{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({content:editedContent,updated_by:0// System update\n})});if(response.ok){setSelectedDoc(prev=>_objectSpread(_objectSpread({},prev),{},{content:editedContent,updated_at:new Date().toISOString()}));setEditMode(false);fetchDocuments();// Refresh the list\n}else{throw new Error('Failed to save');}}catch(err){setError('Failed to save document');}finally{setSaving(false);}},[apiBaseUrl,selectedDoc,editedContent,fetchDocuments]);const formatSize=useCallback(bytes=>{if(bytes<1024)return bytes+' B';if(bytes<1024*1024)return(bytes/1024).toFixed(1)+' KB';return(bytes/(1024*1024)).toFixed(1)+' MB';},[]);const filteredDocs=documents.filter(doc=>doc.name.toLowerCase().includes(filter.toLowerCase())||doc.title.toLowerCase().includes(filter.toLowerCase())||doc.category.toLowerCase().includes(filter.toLowerCase()));// Group documents by category\nconst docsByCategory=filteredDocs.reduce((acc,doc)=>{if(!acc[doc.category]){acc[doc.category]=[];}acc[doc.category].push(doc);return acc;},{});if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"document-browser loading\",children:\"Loading documents...\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"document-browser\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"document-list\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Documents\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Filter documents...\",value:filter,onChange:e=>setFilter(e.target.value),className:\"filter-input\"}),/*#__PURE__*/_jsx(\"div\",{className:\"document-categories\",children:Object.entries(docsByCategory).map(_ref2=>{let[category,docs]=_ref2;return/*#__PURE__*/_jsxs(\"div\",{className:\"doc-category\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"category-name\",children:category}),/*#__PURE__*/_jsx(\"div\",{className:\"doc-items\",children:docs.map(doc=>/*#__PURE__*/_jsxs(\"div\",{className:\"doc-item \".concat((selectedDoc===null||selectedDoc===void 0?void 0:selectedDoc.name)===doc.name?'selected':''),onClick:()=>selectDocument(doc),children:[/*#__PURE__*/_jsx(\"div\",{className:\"doc-name\",children:doc.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"doc-meta\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"doc-format\",children:doc.format}),/*#__PURE__*/_jsx(\"span\",{className:\"doc-size\",children:formatSize(doc.size)})]})]},doc.name))})]},category);})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"document-details\",children:selectedDoc?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"doc-header\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{children:selectedDoc.title||selectedDoc.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"doc-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"doc-category-badge\",children:selectedDoc.category}),/*#__PURE__*/_jsx(\"span\",{className:\"doc-format-badge\",children:selectedDoc.format})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"doc-actions\",children:[!editMode&&selectedDoc.format==='markdown'&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowMarkdownPreview(!showMarkdownPreview),className:\"toggle-button\",children:showMarkdownPreview?'Show Raw':'Show Preview'}),!editMode?/*#__PURE__*/_jsx(\"button\",{onClick:handleEdit,className:\"edit-button\",children:\"Edit\"}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleSave,className:\"save-button\",disabled:saving,children:saving?'Saving...':'Save'}),/*#__PURE__*/_jsx(\"button\",{onClick:handleCancel,className:\"cancel-button\",disabled:saving,children:\"Cancel\"})]})]})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:error}),/*#__PURE__*/_jsxs(\"div\",{className:\"doc-content-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"field-group\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"Content\",!editMode&&selectedDoc.format==='markdown'&&/*#__PURE__*/_jsx(\"span\",{className:\"preview-label\",children:\" (Markdown Preview)\"})]}),editMode?/*#__PURE__*/_jsx(\"textarea\",{value:editedContent,onChange:e=>setEditedContent(e.target.value),className:\"content-editor\",rows:25,spellCheck:false}):selectedDoc.format==='markdown'&&showMarkdownPreview?/*#__PURE__*/_jsx(\"div\",{className:\"markdown-preview\",children:/*#__PURE__*/_jsx(ReactMarkdown,{remarkPlugins:[remarkGfm],components:{code(_ref3){let{node,inline,className,children}=_ref3,props=_objectWithoutProperties(_ref3,_excluded);const match=/language-(\\w+)/.exec(className||'');return!inline&&match?/*#__PURE__*/_jsx(\"pre\",{className:\"code-block\",children:/*#__PURE__*/_jsx(\"code\",_objectSpread(_objectSpread({className:className},props),{},{children:children}))}):/*#__PURE__*/_jsx(\"code\",_objectSpread(_objectSpread({className:\"inline-code\"},props),{},{children:children}));},table(_ref4){let{node}=_ref4,props=_objectWithoutProperties(_ref4,_excluded2);return/*#__PURE__*/_jsx(\"div\",{className:\"table-wrapper\",children:/*#__PURE__*/_jsx(\"table\",_objectSpread({},props))});}},children:selectedDoc.content})}):/*#__PURE__*/_jsx(\"pre\",{className:\"content-display\",children:selectedDoc.content})]}),!editMode&&/*#__PURE__*/_jsxs(\"div\",{className:\"doc-metadata\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"metadata-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"meta-label\",children:\"Name:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"meta-value\",children:selectedDoc.name})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"metadata-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"meta-label\",children:\"Format:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"meta-value\",children:selectedDoc.format})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"metadata-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"meta-label\",children:\"Version:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"meta-value\",children:selectedDoc.version||'1.0'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"metadata-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"meta-label\",children:\"Access Level:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"meta-value\",children:selectedDoc.access_level||'system'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"metadata-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"meta-label\",children:\"Created:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"meta-value\",children:new Date(selectedDoc.created_at).toLocaleString()})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"metadata-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"meta-label\",children:\"Updated:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"meta-value\",children:new Date(selectedDoc.updated_at).toLocaleString()})]})]})]})]}):/*#__PURE__*/_jsx(\"div\",{className:\"no-selection\",children:\"Select a document to view details\"})})]});}export default DocumentBrowser;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}